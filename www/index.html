<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>P.I.D Demo</title>
  <style type="text/css">
    head {
      text-align: center;
    }

    body {
      background-image: url(/img/audi_r8.png);
      background-repeat: no-repeat;
      background-size: 100% 165%;

    }

    h2 {
      font: normal normal normal 32px/1 Helvetica, arial, sans-serif;
      border-bottom: 2px solid #fff;
      background: #fff;
      color: #000;

      display: inline-block;

    }

    .active {
      background-color: #F11444;
    }

    .column {
      float: left;
      width: 50%;
    }

    /* Clear floats after the columns */

    .row {
      height: 1500;
    }

    .row:after {
      content: "";
      display: table;
      clear: both;
    }

    .header {
      background: #fff;
    }

    #matrixTB {
      cursor: pointer;
      width: 200px;
      height: 200px;
      border-collapse: separate;
      border-width: 0;
      border-spacing: 0;
    }

    #matrixTB td {
      padding: 0;
      height: 10px;
      width: 15px;
      background-color: #e2e2e0;
      border: 1px solid #e2e2e0;
      /*#cccccc;*/
      text-align: center;
    }

    #matrixTB tr {
      padding: 0;
      height: 10px;
      width: 15px;
      background-color: #e2e2e0;
      border: 1px solid #e2e2e0;
      /*#cccccc;*/
      text-align: center;
    }


    #d1 {
      border: 1px solid blue !important;
    }

    #d4 {
      border: 1px solid yellow !important;
    }

    #d24 {
      border: 1px solid white !important;
    }

    #d25 {
      border-bottom: 1px solid greenyellow !important;
    }

    #d26 {
      border-bottom: 1px solid greenyellow !important;
    }

    #d27 {
      border-bottom: 1px solid greenyellow !important;
    }

    #d28 {
      border-bottom: 1px solid greenyellow !important;
    }

    #d32 {
      border: 1px solid white !important;
    }

    #d33 {
      border: 1px solid yellow !important;
    }

    #d34 {
      border: 1px solid red !important;
    }

    #d35 {
      border: 1px solid red !important;
    }

    #d37 {
      border-left: 1px solid greenyellow !important;
    }

    #d40 {
      border: 1px solid white !important;
    }

    #d41 {
      border-top: 1px solid greenyellow !important;
    }

    #d42 {
      border-top: 1px solid greenyellow !important;
    }

    #d43 {
      border-top: 1px solid greenyellow !important;
    }

    #d44 {
      border-top: 1px solid greenyellow !important;
    }

    #d48 {
      border: 1px solid blue !important;
    }

    #d56 {
      border: 1px solid white !important;
    }

    #d57 {
      border: 1px solid white !important;
    }


    #d58 {
      border: 1px solid white !important;
    }


    #d59 {
      border: 1px solid red !important;
    }

    #d60 {
      border: 1px solid purple !important;
    }
  </style>
</head>

<body>
  <div class="header">
    <center>
      <h2>Welcome to AAZ</h2>
    </center>
  </div>
  <div class="row">
    <div class="column">
      <table id="matrixTB" align="center" width="400px" hight="400px">
        <tr>
          <td id="d1">14</td>
          <td id="d2">&nbsp;</td>
          <td id="d3">&nbsp;</td>
          <td id="d4">15</td>
          <td id="d5">&nbsp;</td>
          <td id="d6">&nbsp;</td>
          <td id="d7">&nbsp;</td>
          <td id="d8">&nbsp;</td>
        </tr>
        <tr>
          <td id="d9">&nbsp;</td>
          <td id="d10">&nbsp;</td>
          <td id="d11">&nbsp;</td>
          <td id="d12">&nbsp;</td>
          <td id="d13">&nbsp;</td>
          <td id="d14">&nbsp;</td>
          <td id="d15">&nbsp;</td>
          <td id="d16">&nbsp;</td>
        </tr>
        <tr>
          <td id="d17">&nbsp;</td>
          <td id="d18">&nbsp;</td>
          <td id="d19">&nbsp;</td>
          <td id="d20">&nbsp;</td>
          <td id="d21">&nbsp;</td>
          <td id="d22">&nbsp;</td>
          <td id="d23">&nbsp;</td>
          <td id="d24">9</td>
        </tr>
        <tr>
          <td id="d25">&nbsp;</td>
          <td id="d26">&nbsp;</td>
          <td id="d27">&nbsp;</td>
          <td id="d28">&nbsp;</td>
          <td id="d29">&nbsp;</td>
          <td id="d30">&nbsp;</td>
          <td id="d31">&nbsp;</td>
          <td id="d32">8</td>
        </tr>
        <tr>
          <td id="d33">10</td>
          <td id="d34">11</td>
          <td id="d35">12</td>
          <td id="d36">13</td>
          <td id="d37">&nbsp;</td>
          <td id="d38">&nbsp;</td>
          <td id="d39">&nbsp;</td>
          <td id="d40">7</td>
        </tr>
        <tr>
          <td id="d41">&nbsp;</td>
          <td id="d42">&nbsp;</td>
          <td id="d43">&nbsp;</td>
          <td id="d44">&nbsp;</td>
          <td id="d45">&nbsp;</td>
          <td id="d46">&nbsp;</td>
          <td id="d47">&nbsp;</td>
          <td id="d48">6</td>
        </tr>
        <tr>
          <td id="d49">&nbsp;</td>
          <td id="d50">&nbsp;</td>
          <td id="d51">&nbsp;</td>
          <td id="d52">&nbsp;</td>
          <td id="d53">&nbsp;</td>
          <td id="d54">&nbsp;</td>
          <td id="d55">&nbsp;</td>
          <td id="d56">5</td>
        </tr>
        <tr>
          <td id="d57">1</td>
          <td id="d58">2</td>
          <td id="d59">3</td>
          <td id="d60">4</td>
          <td id="d61">&nbsp;</td>
          <td id="d62">&nbsp;</td>
          <td id="d63">&nbsp;</td>
          <td id="d64">&nbsp;</td>
        </tr>
      </table>
    </div>
    <div class="column">
      <!--
      <img src="/img/audi.jpg" alt="Audi" align="top" height="80" width="200">
      -->
      <p id="i01">Loading...</p>
    </div>
  </div>


  <p align="center">
    <input type="button" value="Reset" id="resetBtn" />
  </p>

  <script src="/socket.io/socket.io.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script>
    var press = false;
    var socket = io.connect();
    var m_array = [];

    const parkspace_to_grid = {
      1: 56,
      2: 57,
      3: 58,
      4: 59,
      5: 55,
      6: 47,
      7: 39,
      8: 31,
      9: 23,
      10: 32,
      11: 33,
      12: 34,
      13: 35,
      14: 0,
      15: 3
    };

    const grid_to_parkspace = swap(parkspace_to_grid);


    $(document).mousedown(function () {
      press = true;
    });
    $(document).mouseup(function () {
      press = false;

      matrixVal();
    });

    $('td').mousedown(function (e) {
      toggleDot($(this));
      e.preventDefault();
    });

    $('td').mouseover(function (e) {
      if (press) {
        toggleDot($(this));
        e.preventDefault();
      }
    });

    $("#resetBtn").click(function () {
      var index = 0;
      reset()
      m_array = [0, 0, 0, 0, 0, 0, 0, 0];
      //send2Server();
    });

    socket.on('park', function (data) {
      reset()
      var occupied = data["occupied"];
      var ins = data["instruction"];
      var show_instruction = "";
      var assign = data["assign"];



      draw_occupied(occupied, assign);

      for (let i = 0; i < ins.length; i++) {
        show_instruction += (ins[i] + "\n");
      }
      show_instruction = show_instruction.replace(/\n/g, "<br />");
      $("#i01").html(show_instruction);
    });

    function draw_occupied(occupied, assign) {
      for (let i = 1; i < 65; i++) {
        if (occupied[i - 1] == 1) {
          $("#d" + i).css("background-color", "yellow");
        }
        else if (assign.indexOf(i - 1) > -1) {
          $("#d" + i).css("background-color", "green");
        }
        else {
          $("#d" + i).css("background-color", "#e2e2e0");
        }
      }
    }


    function toggleDot(me) {
      if (me.html() == '0') {
        me.css("background-color", "yellow");
        me.html("1");
      } else {
        console.log('one');
        me.css("background-color", "#e2e2e0");
        me.html("0");
      }
    }

    function swap(json) {
      var ret = {};
      for (var key in json) {
        ret[json[key]] = key;
      }
      return ret;
    }

    function reset() {
      for (var i = 1; i < 65; i++) {
        var temp;
        if ((i - 1) in grid_to_parkspace) {
          $("#d" + i).html(String(grid_to_parkspace[i - 1]));
          $("#d" + i).css("background-color", "#e2e2e0");
        }
        else {
          $("#d" + i).html('&nbsp;');
          $("#d" + i).css("background-color", "#e2e2e0");
        }
      }
    }

    function matrixVal() {
      var data = '';
      m_array = [];

      for (var i = 1; i < 65; i++) {
        data += $("#d" + i).html();

        if ((i % 8) == 0) {
          m_array.push(data);
          data = '';
        }
      }

      send2Server();
    }

    function send2Server() {
      socket.emit('live_matrix', {
        'm': m_array
      });
    }
  </script>
</body>

</html>